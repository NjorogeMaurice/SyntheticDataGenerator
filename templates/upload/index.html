{% extends "base.html" %}

{% block content %}
    <!-- component -->
    <div class="pt-16">
<div class="max-w-xl mx-auto my-4 border-b-2 pb-4">
	<div class="flex pb-3">
		<div class="flex-1"></div>

{#		<div class="flex-1">#}
{#			<div class="w-10 h-10 bg-green-700 mx-auto rounded-full text-lg text-white flex items-center">#}
{#				<span class="text-white text-center w-full"><i class="fa fa-check w-full fill-current text-white"></i></span>#}
{#			</div>#}
{#		</div>#}
        <div class="flex-1">
			<div class="w-10 h-10 bg-white border-2 border-gray-300 mx-auto rounded-full text-lg text-white flex items-center">
				<span class="text-gray-700 text-center w-full">1</span>
			</div>
		</div>

{#		<div class="w-1/6 align-center items-center align-middle content-center flex">#}
{#			<div class="w-full bg-green-500 rounded items-center align-middle align-center flex-1">#}
{#			  	<div class="bg-green-500 text-xs leading-none py-1 text-center text-gray-900 rounded" style="width: 100%"></div>#}
{#			</div>#}
{#		</div>#}
        <div class="w-1/6 align-center items-center align-middle content-center flex">
			<div class="w-full bg-white border-2 border-gray-300 rounded items-center align-middle align-center flex-1">
			  	<div class="bg-white text-xs leading-none py-1 text-center text-gray-900 rounded" style="width: 50%"></div>
			</div>
		</div>

{#		<div class="flex-1">#}
{#			<div class="w-10 h-10 bg-green-700 mx-auto rounded-full text-lg text-white flex items-center">#}
{#				<span class="text-white text-center w-full"><i class="fa fa-check w-full fill-current text-white"></i></span>#}
{#			</div>#}
{#		</div>#}
        <div class="flex-1">
			<div class="w-10 h-10 bg-white border-2 border-gray-300 mx-auto rounded-full text-lg text-white flex items-center">
				<span class="text-gray-700 text-center w-full">2</span>
			</div>
		</div>

		<div class="w-1/6 align-center items-center align-middle content-center flex">
			<div class="w-full bg-white border-2 border-gray-300 rounded items-center align-middle align-center flex-1">
			  	<div class="bg-white text-xs leading-none py-1 text-center text-gray-900 rounded" style="width: 50%"></div>
			</div>
		</div>

		<div class="flex-1">
			<div class="w-10 h-10 bg-white border-2 border-gray-300 mx-auto rounded-full text-lg text-white flex items-center">
				<span class="text-gray-700 text-center w-full">3</span>
			</div>
		</div>

		<div class="flex-1"></div>
	</div>

	<div class="flex text-xs content-center text-center">
		<div class="w-1/3">
			Data Upload
		</div>
		<div class="w-1/3">
			Generate Data
		</div>
		<div class="w-1/3">
			Download Data
		</div>
	</div>
</div>


<div class="max-w-4xl mx-auto p-6 bg-white shadow-lg rounded-xl">
    <h2 class="text-2xl font-bold text-gray-700 text-center">Upload Dataset</h2>
    <p class="text-gray-600 text-center mt-2">Upload a CSV file or provide a link to start generating synthetic data.</p>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="space-y-2">
                {% for category, message in messages %}
                    <div class="p-3 rounded-lg text-white
                        {% if category == 'success' %} bg-green-500 {% elif category == 'error' %} bg-red-500 {% else %} bg-gray-500 {% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}


    <form method="POST" enctype="multipart/form-data" action="/synthetic-data/upload" class="mt-6 space-y-4" id="upload-form">
        <div class="flex flex-col sm:flex-row gap-4">
            <input type="file" name="dataset" accept=".csv" 
                   class="file-input border border-gray-300 rounded-lg p-2 w-full sm:w-2/3">
            <input type="url" name="dataset_url" placeholder="Or paste a CSV link here..." 
                   class="border border-gray-300 rounded-lg p-2 w-full sm:w-2/3">
        </div>
        <button type="submit" style="background-color: #79C149;" class=" w-full text-white px-6 py-2 rounded-lg hover:bg-[#B8DA89] transition">Upload</button>
    </form>
    <!-- <button id="fetch-dkan-btn" style="background-color: #79C149;" class=" mt-5 w-full text-white px-6 py-2 rounded-lg hover:bg-[#B8DA89] transition">Fetch Data Catalog Datasets</button>
    <div id="dkan-results">

    </div> -->

    {% if data %}
    <div class="mt-8">
        <h3 class="text-lg font-bold text-gray-700">Preview of Uploaded Dataset</h3>
        <div class="overflow-x-auto mt-2">
            <table class="min-w-full border border-gray-300 rounded-lg">
                <thead style="background-color: #79C149;" class=" text-white">
                    <tr>
                        {% for col in headers %}
                        <th class="py-2 px-4 border">{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in data[:5] %}  {# Show only first 5 rows as preview #}
                    <tr class="border-b">
                        {% for cell in row %}
                        <td class="py-2 px-4 border">{{ cell }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
</div>
    <script>
   document.addEventListener("DOMContentLoaded", function () {
    const fetchButton = document.getElementById("fetch-dkan-btn");
    const resultsContainer = document.getElementById("dkan-results");

    fetchButton.addEventListener("click", function () {
        // Show a loading message while fetching
        fetchButton.disabled = true;
        resultsContainer.innerHTML = "<p style='color: blue;'>Fetching...</p>";

        fetch("/synthetic-data/fetch_dkan", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            fetchButton.disabled = false;
            resultsContainer.innerHTML = ""; // Clear previous results

            if (data.urls && data.urls.length > 0) {
                const list = document.createElement("ul");
                list.classList.add("url-list");

                data.urls.forEach(url => {
                    const listItem = document.createElement("li");
                    listItem.classList.add("url-item");

                    // Create link element
                    const link = document.createElement("a");
                    link.href = url;
                    link.textContent = url;
                    link.target = "_blank";

                    // Create Copy button
                    const copyButton = document.createElement("button");
                    copyButton.textContent = "Copy URL";
                    copyButton.classList.add("copy-btn");
                    copyButton.addEventListener("click", function () {
                        navigator.clipboard.writeText(url).then(() => {
                            copyButton.textContent = "Copied!";
                            setTimeout(() => (copyButton.textContent = "Copy URL"), 2000);
                        });
                    });

                    // Append elements
                    listItem.appendChild(link);
                    listItem.appendChild(copyButton);
                    list.appendChild(listItem);
                });

                resultsContainer.appendChild(list);
            } else {
                fetchButton.disabled = false;
                resultsContainer.innerHTML = "<p>No URLs found.</p>";
            }
        })
        .catch(error => {
            fetchButton.disabled = false;
            console.error("Error fetching DKAN data:", error);
            resultsContainer.innerHTML = "<p style='color: red;'>Error fetching data. Please try again.</p>";
        });
    });
});


    </script>


{% endblock %}
